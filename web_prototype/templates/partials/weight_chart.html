<canvas id="weight-chart" class="max-h-48"></canvas>

<script>
    (function() {
        const ctx = document.getElementById('weight-chart');
        if (!ctx) return;

        // Destroy existing chart if it exists
        if (window.weightChart) {
            window.weightChart.destroy();
        }

        window.weightChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Frequency', 'Match Quality', 'Rarity'],
                datasets: [{
                    data: [{{ weights.frequency }}, {{ weights.match }}, {{ weights.rarity }}],
                    backgroundColor: [
                        '#0ea5e9', // primary-500 (blue)
                        '#8b5cf6', // violet-500
                        '#f59e0b', // amber-500
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                animation: false,  // Disable animations for instant updates
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 12,
                            font: {
                                size: 11
                            },
                            usePointStyle: true
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ' + context.parsed.toFixed(1) + '%';
                            }
                        }
                    }
                },
                cutout: '65%'
            }
        });
    })();
</script>

<div class="mt-4 space-y-2 text-xs">
    <div class="flex items-center justify-between">
        <div class="flex items-center gap-2">
            <div class="w-3 h-3 rounded-full bg-[#0ea5e9]"></div>
            <span class="text-slate-600">Frequency</span>
        </div>
        <span class="font-semibold text-slate-900">{{ weights.frequency }}%</span>
    </div>
    <div class="flex items-center justify-between">
        <div class="flex items-center gap-2">
            <div class="w-3 h-3 rounded-full bg-[#8b5cf6]"></div>
            <span class="text-slate-600">Match</span>
        </div>
        <span class="font-semibold text-slate-900">{{ weights.match }}%</span>
    </div>
    <div class="flex items-center justify-between">
        <div class="flex items-center gap-2">
            <div class="w-3 h-3 rounded-full bg-[#f59e0b]"></div>
            <span class="text-slate-600">Rarity</span>
        </div>
        <span class="font-semibold text-slate-900">{{ weights.rarity }}%</span>
    </div>
</div>

<div class="mt-4 pt-4 border-t border-slate-200">
    <p class="text-xs text-slate-500 text-center">
        {% if rarity <= 5 %}
            Favouring popular, well-known artists
        {% elif rarity <= 10 %}
            Balanced between popular and obscure
        {% else %}
            Favouring rare, underground artists
        {% endif %}
    </p>
</div>
